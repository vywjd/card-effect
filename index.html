<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        .wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            background-color: #eee;
            user-select: none;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            aspect-ratio: 1 / 1;
            /* 임시 코드 */
            /* width: 600px; */
            width: min(80vw, 80vh);
            background-color: white;
            gap: 10px;
            padding: 10px;
        }
        .card {
            background-color: skyblue;
            border-radius: 10%;
            border: 2px solid gray;
            color: gray;
            transition: transform 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="grid-container">
            <div class="card">1</div>
            <div class="card">2</div>
            <div class="card">3</div>
            <div class="card">4</div>
            <div class="card">5</div>
            <div class="card">6</div>
            <div class="card">7</div>
            <div class="card">8</div>
            <div class="card">9</div>
            <div class="card">10</div>
            <div class="card">11</div>
            <div class="card">12</div>
            <div class="card">13</div>
            <div class="card">14</div>
            <div class="card">15</div>
            <div class="card">16</div>
            <div class="card">17</div>
            <div class="card">18</div>
            <div class="card">19</div>
            <div class="card">20</div>
            <div class="card">21</div>
            <div class="card">22</div>
            <div class="card">23</div>
            <div class="card">24</div>
            <div class="card">25</div>

        </div>
    </div>
    <script>
    var sensor = document.querySelector('.wrapper');
    var container = document.querySelector('.grid-container');
    var win_x = window.innerWidth;
    var win_y = window.innerHeight;
    var win_min = Math.min(win_x, win_y);
    var max_rotate = 40;
    const cards = document.querySelectorAll('.card');

    cards.forEach((card, index) => {
    const hue = (index / cards.length) * 90 + 90;
    card.style.backgroundColor = `hsl(${hue}, 70%, 80%)`;
    });

    // 창 크기 바뀔 때 갱신
    window.addEventListener("resize", function () {
        win_x = window.innerWidth;
        win_y = window.innerHeight;
        win_min = Math.min(win_x, win_y);
    });

    let isMouseDown = false;

    document.addEventListener('mousedown', () => {
    isMouseDown = true;
    updateRotation(event);
    });

    document.addEventListener('mouseup', () => {
    isMouseDown = false;
    cards.forEach(card => {
        card.style.transform = 'none';  // 원래대로 돌아가도록 transform 초기화
    });
    });

    // 마우스에 따른 카드 회전 함수
    function updateRotation(event) {
        // card class를 가진 div들을 각각 하나씩 조작
        cards.forEach(card => {
            const rect = card.getBoundingClientRect();  
            // card의 중앙의 위치를 화면 기준으로 산출
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const x = event.clientX - centerX;
            const y = event.clientY - centerY;

            var rotateX = (-max_rotate / win_min) * y * 2;
            var rotateY = (max_rotate / win_min) * x * 2;

            const length = Math.hypot(rotateX, rotateY, 0);

            card.style.transform = `
                perspective(1000px)
                rotate3d(${rotateX / length}, ${rotateY / length}, 0, ${length}deg)
            `;
        });
    }

    document.addEventListener('mousemove', (event) => {
        if (!isMouseDown) return;
        updateRotation(event);
    });

    </script>

</body>
</html>